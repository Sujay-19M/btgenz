<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Comment Moderation</title>
</head>
<body>

    <!-- ✅ Universal Header -->
    <div id="header"></div>

    <main>
        <h1>Comment Moderation Panel</h1>
        <div id="pending-comments" class="comment-container">
            <p>Loading comments...</p>
        </div>
        <button id="submit-btn" class="submit-btn">Submit Changes</button>
    </main>

    <!-- ✅ Universal Footer -->
    <div id="footer"></div>

    <script src="/scripts/admin.js"></script>
</body>
</html>
<style>
    body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    text-align: center;
}

h1 {
    margin-top: 20px;
    color: #333;
}

.comment-container {
    max-width: 600px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

.comment-box {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 10px;
    border-bottom: 1px solid #ddd;
}

.comment-box:last-child {
    border-bottom: none;
}

.comment-text {
    font-size: 16px;
    margin-bottom: 10px;
}

button {
    padding: 8px 15px;
    margin-right: 10px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    font-size: 14px;
}

.approve-btn {
    background-color: #28a745;
    color: white;
}

.reject-btn {
    background-color: #dc3545;
    color: white;
}

.reply-input {
    width: 100%;
    margin-top: 8px;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
}

.submit-btn {
    margin-top: 20px;
    padding: 10px 20px;
    background-color: #00796b;
    color: white;
    font-size: 16px;
}

</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    loadComments();

    document.getElementById("submit-btn").addEventListener("click", function() {
        submitChanges();
    });

    loadHeaderFooter();
});

// ✅ Load Universal Header & Footer
function loadHeaderFooter() {
    document.getElementById("header").innerHTML = '<object type="text/html" data="/universal/header.html" width="100%" height="auto"></object>';
    document.getElementById("footer").innerHTML = '<object type="text/html" data="/universal/footer.html" width="100%" height="auto"></object>';
}

// ✅ Load Pending Comments
async function loadComments() {
    const container = document.getElementById("pending-comments");
    container.innerHTML = "<p>Loading comments...</p>";

    try {
        const response = await fetch("https://comment.sujay-m-1194.workers.dev/pending");
        if (!response.ok) throw new Error("Failed to load comments");

        const comments = await response.json();
        container.innerHTML = "";

        if (comments.length === 0) {
            container.innerHTML = "<p>No pending comments.</p>";
            return;
        }

        comments.forEach((comment, index) => {
            const commentBox = document.createElement("div");
            commentBox.classList.add("comment-box");

            commentBox.innerHTML = `
                <p class="comment-text"><strong>${comment.name}:</strong> ${comment.comment}</p>
                <input type="text" class="reply-input" placeholder="Reply (optional)" id="reply-${index}">
                <button class="approve-btn" onclick="approveComment(${index})">Approve</button>
                <button class="reject-btn" onclick="rejectComment(${index})">Reject</button>
            `;

            container.appendChild(commentBox);
        });
    } catch (error) {
        container.innerHTML = `<p style="color: red;">Error loading comments: ${error.message}</p>`;
    }
}

// ✅ Approve a Comment
async function approveComment(index) {
    const replyInput = document.getElementById(`reply-${index}`).value;

    try {
        const response = await fetch("https://comment.sujay-m-1194.workers.dev/approve", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ index, reply: replyInput })
        });

        if (!response.ok) throw new Error("Failed to approve comment");

        alert("Comment Approved!");
        loadComments(); // Reload comments after approval
    } catch (error) {
        alert("Error approving comment: " + error.message);
    }
}

// ✅ Reject a Comment
async function rejectComment(index) {
    try {
        const response = await fetch("https://comment.sujay-m-1194.workers.dev/reject", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ index })
        });

        if (!response.ok) throw new Error("Failed to reject comment");

        alert("Comment Rejected!");
        loadComments(); // Reload comments after rejection
    } catch (error) {
        alert("Error rejecting comment: " + error.message);
    }
}

// ✅ Submit all changes (optional)
async function submitChanges() {
    alert("All changes submitted successfully!");
    loadComments(); // Refresh the comment list
}

</script>
